
# 简介
# 一 、安装
# 二 、权限

权限列表：

![权限.png](..\a_docs\image\mongo权限列表.jpg)
## 2.1 创建管理员用户

mongodb有一个用户管理机制,简单描述为,有一个管理用户组,这个组的用户是专门为管理普通用户而设的,称之为管理员。管理员通常没有数据库的读写权限只有操作用户的权限,因此我们只需要赋予管理员userAdminAnyDatabaseh色即可。另外管理员账户必须在admin数据库下创建。

```
use admin #使用admin数据库
db.system.users.find() #查看用户
db.createUser({
		user:'<name>',
		pwd:'<password>',
		customData:{<any information>},
		roles:[
			{role:'<role>',db:'<database>'} |'<role>',
		]
	}) # name:新建的用户名 password:密码 customData:存放一些用户相关的自定义数据，此属性可忽略 roles：数组类型，用户的权限
db.createUser({
		user:'admin',
		pwd:'public',
		roles:[
			{role:'root',db:'admin'}
		]
	}) #创建一个超级管理员用户
db.auth('admin', 'public') #使用新创建的用户

```



## 2.2 创建普通用户

```
use iot #创建一个iot数据库
db.createUser({
		user:'iot',
		pwd:'root',
		roles:[
			{role:'readWrite',db:'iot'}
		]
	}) #创建一个iot普通用户 并分配读和写权限 指定操作iot数据库
db.auth('iot', 'root') #使用iot用户
```

## 2.3 修改用户角色

如果我们需要对已存在的用户的角色做修改,那么我们可以使用db.updateUser())函数来更新用户角色。注意,该函数需要 前用户具有userAdminAnyDatabase或者更高的权限。

```
db.updateUser({
	    '<user>',
	    {'roles':[{'role':'<role>','db':'<database>'},{'role':'<role>','db':'<database>'}]}
	}) #
	
db.updateUser({
	    'iot',
	    {'roles':[{'role':'readWrite','db':'iot'},{'role':'read','db':'iot'}]}
	}) #
```



# 三 、shell操作

## 3.1 添加文档

```
db.<document>.insert({'key':'value'}) #单条插入
```

## 3.2 查询文档

```
db.<document>.find() #查询集合
```

# 四、spring data mongodb



# 五、副本集

# 5.1 简介

MongoDB中的副本集（Replica Set）是一组维护相同数据集的mongod服务。 副本集可提供冗余和高
可用性，是所有生产部署的基础。

也可以说，副本集类似于有自动故障恢复功能的主从集群。通俗的讲就是用多台机器进行同一数据的异
步同步，从而使多台机器拥有同一数据的多个副本，并且当主库当掉时在不需要用户干预的情况下自动
切换其他备份服务器做主库。而且还可以利用副本服务器做只读服务器，实现读写分离，提高负载。

（1）冗余和数据可用性
复制提供冗余并提高数据可用性。 通过在不同数据库服务器上提供多个数据副本，复制可提供一定级别
的容错功能，以防止丢失单个数据库服务器。
在某些情况下，复制可以提供增加的读取性能，因为客户端可以将读取操作发送到不同的服务上， 在不
同数据中心维护数据副本可以增加分布式应用程序的数据位置和可用性。 您还可以为专用目的维护其他
副本，例如灾难恢复，报告或备份。

（2）MongoDB中的复制
副本集是一组维护相同数据集的mongod实例。 副本集包含多个数据承载节点和可选的一个仲裁节点。
在承载数据的节点中，一个且仅一个成员被视为主节点，而其他节点被视为次要（从）节点。
主节点接收所有写操作。 副本集只能有一个主要能够确认具有{w：“most”}写入关注的写入; 虽然在某
些情况下，另一个mongod实例可能暂时认为自己也是主要的。主要记录其操作日志中的数据集的所有
更改，即oplog 。



副本集有两种类型三种角色
两种类型：

主节点（Primary）类型：数据操作的主要连接点，可读写。

次要（辅助、从）节点（Secondaries）类型：数据冗余备份节点，可以读或选举。



三种角色：

主要成员（Primary）：主要接收所有写操作。就是主节点。
副本成员（Replicate）：从主节点通过复制操作以维护相同的数据集，即备份数据，不可写操作，但可
以读操作（但需要配置）。是默认的一种从节点类型。
仲裁者（Arbiter）：不保留任何数据的副本，只具有投票选举作用。当然也可以将仲裁服务器维护为副
本集的一部分，即副本成员同时也可以是仲裁者。也是一种从节点类型。 



关于仲裁者的额外说明：
可以将额外的mongod实例添加到副本集作为仲裁者。 仲裁者不维护数据集。 仲裁者的目的是通过
响应其他副本集成员的心跳和选举请求来维护副本集中的仲裁。 因为它们不存储数据集，所以仲裁器可
以是提供副本集仲裁功能的好方法，其资源成本比具有数据集的全功能副本集成员更便宜。
如果副本集具有偶数个成员，请添加仲裁者以获得主要选举中的“大多数”投票。 仲裁者不需要专用
硬件。
仲裁者将永远是仲裁者，而主要人员可能会退出并成为次要人员，而次要人员可能成为选举期间的主要
人员。
如果副本+主节点的个数是偶数，建议加一个仲裁者，形成奇数，容易满足大多数的投票。

如果副本+主节点的个数是奇数，可以不加仲裁者 

## 5.2 副本集架构



